(this.webpackJsonpbolphaia=this.webpackJsonpbolphaia||[]).push([[0],{162:function(e,t,a){e.exports=a.p+"static/media/whitePawn.d69014fb.svg"},163:function(e,t,a){e.exports=a.p+"static/media/blackPawn.1c52d8c4.svg"},164:function(e,t,a){e.exports=a.p+"static/media/hopliteWhite.57f58823.svg"},165:function(e,t,a){e.exports=a.p+"static/media/hopliteBlack.295d049a.svg"},166:function(e,t,a){e.exports=a.p+"static/media/whiteCataphract.e6294efe.svg"},167:function(e,t,a){e.exports=a.p+"static/media/blackCataphract.d39f1d02.svg"},168:function(e,t,a){e.exports=a.p+"static/media/whiteArcher.9cbde199.svg"},169:function(e,t,a){e.exports=a.p+"static/media/blackArcher.ae09d6fb.svg"},196:function(e,t,a){e.exports=a(343)},343:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),r=a(45),o=a.n(r);a(89),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var l,s,c=a(160),u=a(23),h=a(15),d=a(17),v=a(18),m=a(16),p=a(19),g=a(46),y=a(161),f=a.n(y),b=a(54),k=a.n(b);function j(e){return n.createElement("span",{className:"health-box"},n.createElement("span",{className:"remaining-health",style:{height:S(e.maxHealth,e.remainingHealth)}}))}function S(e,t){return"".concat(t/e*29,"px")}!function(e){e.phrygians="phrygians",e.hitites="hitites"}(l||(l={})),function(e){e.levy="levy",e.archer="archer",e.cataphract="cataphract",e.hoplite="hoplite"}(s||(s={}));var w=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(d.a)(this,Object(v.a)(t).call(this,e))).state=void 0,a.state={hoverIcon:""},a}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e,t;return n.createElement("button",{className:"square ".concat(this.props.cssClasses.join(" ")," ").concat(this.state.hoverIcon),onClick:this.onClick.bind(this),onMouseEnter:this.setHoverIconFromGameCallback.bind(this),onMouseLeave:this.resetHoverIcon.bind(this),style:{backgroundImage:"url(".concat(null===(e=this.props)||void 0===e?void 0:null===(t=e.piece)||void 0===t?void 0:t.getImageUrl(),")")||!1}},this.props.piece?n.createElement(j,{maxHealth:this.props.piece.maxHealth,remainingHealth:this.props.piece.health}):"")}},{key:"onClick",value:function(){return this.props.onMoveClick(),this.setHoverIconFromGameCallback()}},{key:"resetHoverIcon",value:function(){return this.setState({hoverIcon:""})}},{key:"setHoverIconFromGameCallback",value:function(){var e=this;return this.setState((function(t){return{hoverIcon:e.props.getHoverIcon()}}))}}]),t}(n.Component),x=function(e){function t(){return Object(h.a)(this,t),Object(d.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){for(var e=[],t=this.props.boardState.length,a=this.props.boardState[0].length,i=0;i<t;i++){for(var r=[],o=0;o<a;o++){var l=[];l.push(E(i)&&E(o)||!E(i)&&!E(o)?"light-square":"dark-square");var s=this.props.boardState[i][o],c=this.props.highlightState.length&&this.props.highlightState[i][o];c&&c.canMove&&l.push(!0===c.canAttack?"highlighted-square-red":"highlighted-square-green"),c&&c.inAttackRange&&l.push("highlighted-square-in-ranged-attack"),r.push(this.renderSquare(i,o,l,s))}e.push(n.createElement("div",{key:i,className:"board-row"},r))}return n.createElement("div",null,e)}},{key:"renderSquare",value:function(e,t,a,i){var r=this;return n.createElement(w,{key:8*e+t,cssClasses:a,piece:i,onMoveClick:function(){return r.props.onMoveClick({x:e,y:t})},getHoverIcon:function(){return r.props.getHoverIcon({x:e,y:t})}})}}]),t}(n.Component);function E(e){return e%2===0}var O=function(){function e(t){Object(h.a)(this,e),this.player=void 0,this.isSelected=!1,this.pieceType=s.levy,this.health=void 0,this.maxHealth=void 0,this.attack=0,this.moveRange=0,this.player=t}return Object(m.a)(e,[{key:"takeDamage",value:function(e){return this.health=this.health-e,this.health}},{key:"setHealth",value:function(e){this.health=e}}]),e}(),I=a(162),R=a.n(I),C=a(163),M=a.n(C),H=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(a=Object(d.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(i)))).pieceType=s.levy,a.moveRange=2,a.health=2,a.maxHealth=2,a.attack=1,a}return Object(p.a)(t,e),Object(m.a)(t,[{key:"getImageUrl",value:function(){return this.player===l.phrygians?R.a:M.a}}]),t}(O),q=a(164),A=a.n(q),T=a(165),P=a.n(T),U=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(a=Object(d.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(i)))).pieceType=s.hoplite,a.moveRange=1,a.health=8,a.maxHealth=8,a.attack=3,a}return Object(p.a)(t,e),Object(m.a)(t,[{key:"getImageUrl",value:function(){return this.player===l.phrygians?A.a:P.a}}]),t}(O),G=a(166),F=a.n(G),N=a(167),B=a.n(N),L=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(a=Object(d.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(i)))).pieceType=s.cataphract,a.moveRange=5,a.health=10,a.maxHealth=10,a.attack=5,a}return Object(p.a)(t,e),Object(m.a)(t,[{key:"getImageUrl",value:function(){return this.player===l.phrygians?F.a:B.a}}]),t}(O);function D(e,t,a){if(t.x<0||e.x<0||t.y<0||e.y<0)return[];var n=t.x-e.x,i=t.y-e.y,r=n<0,o=i<0,l=0,s=0,c=[e],u=a[e.x][e.y];if(!u)return[];for(;0!==n||0!==i;){0!==n&&(l+=r?-1:1,n+=r?1:-1),0!==i&&(s+=o?-1:1,i+=o?1:-1);var h=a[e.x+l][e.y+s],d={x:e.x+l,y:e.y+s};if(null!==h){u.player!==h.player&&c.push(d);break}if(c.push(d),(0===d.x||d.x===Y-1)&&0!==i||(0===d.y||d.y===X-1)&&0!==n)break}return c}var V,J=a(168),W=a.n(J),z=a(169),$=a.n(z),K=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(a=Object(d.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(i)))).pieceType=s.archer,a.moveRange=2,a.health=2,a.maxHealth=2,a.attack=1,a.range=4,a}return Object(p.a)(t,e),Object(m.a)(t,[{key:"getImageUrl",value:function(){return this.player===l.phrygians?W.a:$.a}}]),t}(function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(a=Object(d.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(i)))).range=0,a}return Object(p.a)(t,e),t}(O)),Q="https://bolphaia-backend.herokuapp.com",X=24,Y=16,Z=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(d.a)(this,Object(v.a)(t).call(this,e))).state=void 0,a.state={turn:l.phrygians,selectedSquare:null,boardState:a.initializeBoard(Y,X),highlightState:a.generateEmptyHighlightedMoves(),mouseHoverIcon:""},a.props.offlineMode||(V=new f.a("6e48a6609db3a8a6b150",{cluster:"mt1",forceTLS:!0})),a}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return n.createElement("div",null,n.createElement("div",{className:"current-turn-text"},"Current turn:\xa0",n.createElement("span",{style:{color:this.state.turn===l.phrygians?"white":"black"}},Object(g.capitalize)(this.state.turn))),n.createElement(x,{boardState:this.state.boardState,highlightState:this.state.highlightState,onMoveClick:this.onMoveClick.bind(this),getHoverIcon:this.getHoverIcon.bind(this)}))}}]),Object(m.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.offlineMode||(V.subscribe("game-".concat(this.props.roomId)).bind("board-updated",(function(){e.updateGame()})),this.setupGame())}},{key:"componentWillUnmount",value:function(){this.props.offlineMode||V.unsubscribe("game-".concat(this.props.roomId))}},{key:"getPlayers",value:function(){return Object.keys(this.state.players||{})}},{key:"setupGame",value:function(){var e=this;k.a.request({url:this.urlToGameServer}).then((function(t){var a;if(t.data.players)return e.setState({players:t.data.players}),void e.setState({playerSide:t.data.players[null!==(a=e.props.userId)&&void 0!==a?a:""]})}))}},{key:"updateGame",value:function(){var e=this;k.a.request({url:this.urlToGameServer}).then((function(t){var a,n,i,r,o,l,c,h,d,v,m,p,y;if(t.data.player!==e.props.userId){var f=null===t||void 0===t?void 0:null===(a=t.data)||void 0===a?void 0:null===(n=a.updatedSquares)||void 0===n?void 0:n[0].row,b=null===t||void 0===t?void 0:null===(i=t.data)||void 0===i?void 0:null===(r=i.updatedSquares)||void 0===r?void 0:r[0].col,k=null===t||void 0===t?void 0:null===(o=t.data)||void 0===o?void 0:null===(l=o.updatedSquares)||void 0===l?void 0:l[0].piece,j=null===t||void 0===t?void 0:null===(c=t.data)||void 0===c?void 0:null===(h=c.updatedSquares)||void 0===h?void 0:h[1].row,S=null===t||void 0===t?void 0:null===(d=t.data)||void 0===d?void 0:null===(v=d.updatedSquares)||void 0===v?void 0:v[1].col,w=null===t||void 0===t?void 0:null===(m=t.data)||void 0===m?void 0:null===(p=m.updatedSquares)||void 0===p?void 0:p[1].piece,x=Object(g.cloneDeep)(e.state.boardState),E=(y={},Object(u.a)(y,s.levy,H),Object(u.a)(y,s.hoplite,U),Object(u.a)(y,s.archer,K),Object(u.a)(y,s.cataphract,L),y),O=k?new E[k.pieceType](k.player,k.health):null;x[f][b]=O,O&&O.setHealth(k.health);var I=w?new E[w.pieceType](w.player,w.health):null;x[j][S]=I,I&&I.setHealth(w.health),e.setState({boardState:x,turn:e.state.playerSide})}}))}},{key:"initializeBoard",value:function(e,t){for(var a=[],n=0;n<e;n++){var i=null;if(1!==n){if(2===n)i=new U(l.phrygians);else if(3===n)i=new H(l.phrygians);else if(n===e-4)i=new H(l.hitites);else if(n===e-3)i=new U(l.hitites);else if(n===e-2){var r=new Array(t).fill(null);r[2]=new L(l.hitites),r[t-3]=new L(l.hitites),r[4]=new K(l.hitites),r[7]=new K(l.hitites),r[10]=new K(l.hitites),r[13]=new K(l.hitites),r[16]=new K(l.hitites),r[19]=new K(l.hitites),a.push(r);continue}a.push(new Array(t).fill(i))}else{var o=new Array(t).fill(null);o[2]=new L(l.phrygians),o[o.length-3]=new L(l.phrygians),o[4]=new K(l.phrygians),o[7]=new K(l.phrygians),o[10]=new K(l.phrygians),o[13]=new K(l.phrygians),o[16]=new K(l.phrygians),o[19]=new K(l.phrygians),a.push(o)}}return a}},{key:"getSelectedPiece",value:function(){return this.state.selectedSquare&&this.state.boardState[this.state.selectedSquare.x][this.state.selectedSquare.y]}},{key:"generateEmptyHighlightedMoves",value:function(){for(var e=[],t=0;t<Y;t++){for(var a=[],n=0;n<X;n++){a.push({canMove:!1,canAttack:!1,inAttackRange:!1})}e.push(a)}return e}},{key:"onMoveClick",value:function(e){if(this.props.offlineMode||this.state.turn===this.state.playerSide){var t=this.state.selectedSquare,a=this.state.boardState[e.x][e.y],n=this.getSelectedPiece(),i=this.state.highlightState[e.x][e.y].canMove;if(n||a){if(!n&&null!=a){if(a.player!==this.state.turn)return;return this.setState({selectedSquare:Object(c.a)({},e),highlightState:this.generatePossibleMovesHighlights(e,a)})}if(n&&!i&&!this.isTargetValidRangedAttack(e,n))return this.setState({selectedSquare:null,highlightState:this.generateEmptyHighlightedMoves()});var r=Object(g.cloneDeep)(this.state.boardState),o=!1;if(n&&a&&this.isTargetValidRangedAttack(e,n))a.takeDamage(n.attack),a.health<=0?r[e.x][e.y]=null:r[e.x][e.y]=a,o=!0;else if(n&&t&&i){if(a&&a!==n)if(a.takeDamage(n.attack),a.health<=0)r[t.x][t.y]=null,r[e.x][e.y]=n;else{var l=D(t,e,this.state.boardState),s=Object(g.findIndex)(l,(function(t){return t.x===e.x&&t.y===e.y}))-1;s<0&&console.error("something went wrong.. should not happen.. crash imminent");var u=l[s];r[t.x][t.y]=null,r[u.x][u.y]=n,r[e.x][e.y]=a}else r[t.x][t.y]=null,r[e.x][e.y]=n;o=!0}if(o&&!this.props.offlineMode){var h,d={player:null!==(h=this.props.userId)&&void 0!==h?h:"",updatedSquares:this.getUpdateServerPayload(r,t,e)};return k.a.request({method:"POST",url:this.urlToGameServer,data:d}),this.setState({boardState:r,selectedSquare:null,highlightState:this.generateEmptyHighlightedMoves(),turn:this.getNewTurn()})}}}}},{key:"getNewTurn",value:function(){return this.state.turn===l.phrygians?l.hitites:l.phrygians}},{key:"getUpdateServerPayload",value:function(e,t,a){var n,i,r,o,l,s,c,u,h,d,v=t&&e[t.x][t.y]&&{player:null===(n=e[t.x][t.y])||void 0===n?void 0:n.player,health:null===(i=e[t.x][t.y])||void 0===i?void 0:i.health,pieceType:null===(r=e[t.x][t.y])||void 0===r?void 0:r.pieceType}||null,m={row:null!==(o=null===t||void 0===t?void 0:t.x)&&void 0!==o?o:-1,col:null!==(l=null===t||void 0===t?void 0:t.y)&&void 0!==l?l:-1,piece:v},p=a&&e[a.x][a.y]&&{player:null===(s=e[a.x][a.y])||void 0===s?void 0:s.player,health:null===(c=e[a.x][a.y])||void 0===c?void 0:c.health,pieceType:null===(u=e[a.x][a.y])||void 0===u?void 0:u.pieceType}||null;return[m,{row:null!==(h=null===a||void 0===a?void 0:a.x)&&void 0!==h?h:-1,col:null!==(d=null===a||void 0===a?void 0:a.y)&&void 0!==d?d:-1,piece:p}]}},{key:"getHoverIcon",value:function(e){var t=this.getSelectedPiece(),a=Object(g.get)(this,"state.boardState[".concat(e.x,"][").concat(e.y,"]"),null);if(!t&&a&&a.player===this.state.turn)return"pointer-icon";if(!t)return"";var n=this.state.highlightState[e.x][e.y];return this.isTargetValidRangedAttack(e,t)?"bow-icon":n.canAttack?"sword-icon":n.canMove?"boots-icon":""}},{key:"generatePossibleMovesHighlights",value:function(e,t){var a=this.generateEmptyHighlightedMoves();if(!t)return a;for(var n=[-t.moveRange,0,t.moveRange],i=0;i<3;i++)for(var r=0;r<3;r++){var o=D(e,{x:this.getValidIndex(e.x+n[i],Y-1),y:this.getValidIndex(e.y+n[r],X-1)},this.state.boardState),l=!0,s=!1,c=void 0;try{for(var u,h=o[Symbol.iterator]();!(l=(u=h.next()).done);l=!0){var d=u.value;a[d.x][d.y].canMove=!0,this.squareHasEnemyPiece(d,t)&&(a[d.x][d.y].canAttack=!0)}}catch(g){s=!0,c=g}finally{try{l||null==h.return||h.return()}finally{if(s)throw c}}}if(t.range)for(var v=t.range,m=Math.max(e.x-v,0);m<=Math.min(e.x+v,Y-1);m++)for(var p=Math.max(e.y-v,0);p<=Math.min(e.y+v,X-1);p++)a[m][p].inAttackRange=!0;return a}},{key:"getValidIndex",value:function(e,t){return e>t?t:e<0?0:e}},{key:"isTargetValidRangedAttack",value:function(e,t){var a,n;return!!t.range&&null!==(a=null===(n=this.state.highlightState[e.x][e.y])||void 0===n?void 0:n.inAttackRange)&&void 0!==a&&a&&this.squareHasEnemyPiece(e,t)}},{key:"squareHasEnemyPiece",value:function(e,t){return Object(g.get)(this,"state.boardState[".concat(e.x,"][").concat(e.y,"].player"),t.player)!==t.player}},{key:"urlToGameServer",get:function(){return"".concat(Q,"/games/").concat(this.props.roomId)}}]),t}(n.Component),_=(a(222),a(353)),ee=a(359),te=a(354),ae=a(344),ne=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(a=Object(d.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(i)))).state={username:""},a}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return i.a.createElement(ee.a,null,i.a.createElement(te.a,{onSubmit:this.handleFormSubmit.bind(this)},i.a.createElement(te.a.Field,null,i.a.createElement("label",null,"Username"),i.a.createElement("input",{placeholder:"Username",value:this.state.username,autoFocus:!0,onChange:this.handleUsernameChange.bind(this)})),i.a.createElement(ae.a,{type:"submit"},"Log in")))}},{key:"handleUsernameChange",value:function(e){this.setState({username:e.target.value})}},{key:"handleFormSubmit",value:function(){this.state.username&&this.props.login(this.state.username)}}]),t}(i.a.Component),ie=a(38),re=a(357),oe=a(112),le=a(356),se=a(36),ce=a(360);function ue(e){var t=e.joined.map((function(t){return i.a.createElement(le.a.Item,{key:t.id},t.id===e.activeRoom&&i.a.createElement(le.a.Content,{floated:"right"},i.a.createElement("a",{onClick:function(){return e.leaveRoom(t.id)}},"Leave")),i.a.createElement(se.a,{name:t.id===e.activeRoom?"angle double right":void 0}),i.a.createElement(le.a.Content,null,i.a.createElement("a",{onClick:function(){return e.enterRoom(t.id)}},t.name)))})),a=e.joinable.map((function(t){return i.a.createElement(le.a.Item,{key:t.id},i.a.createElement(se.a,{name:void 0}),i.a.createElement(le.a.Content,null,i.a.createElement("a",{onClick:function(){return e.enterRoom(t.id)}},t.name)))}));return i.a.createElement("div",null,i.a.createElement(ce.a,{as:"h4"},"Active Rooms"),i.a.createElement(le.a,{divided:!0,relaxed:!0},t),i.a.createElement(ce.a,{as:"h4"},"Joinable Rooms"),i.a.createElement(le.a,{divided:!0,relaxed:!0},a))}var he=a(355),de=a(352),ve=l.phrygians,me=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(d.a)(this,Object(v.a)(t).call(this,e))).state=void 0,a.messagesEnd=void 0,a.gameBoard=void 0,a.state={users:[],messages:[],newMessage:""},e.user.subscribeToRoomMultipart({roomId:e.room.id,messageLimit:100,hooks:{onUserJoined:function(t){a.setState({users:e.room.users})},onUserLeft:function(t){a.setState({users:e.room.users})},onMessage:function(t){var n,i,r,o,l,s,c,u,h,d,v,m,p,g=a.state.messages;(null===t||void 0===t?void 0:null===(n=t.parts)||void 0===n?void 0:null===(i=n[1])||void 0===i?void 0:null===(r=i.payload)||void 0===r?void 0:null===(o=r.url)||void 0===o?void 0:o.startsWith("urn:player:"))&&((h=null===t||void 0===t?void 0:null===(d=t.parts)||void 0===d?void 0:null===(v=d[1])||void 0===v?void 0:null===(m=v.payload)||void 0===m?void 0:null===(p=m.url)||void 0===p?void 0:p.substring(11))!==e.user.id&&(h=void 0));g.push({id:t.id,user:t.senderId,opponent:h,message:null!==(l=null===t||void 0===t?void 0:null===(s=t.parts)||void 0===s?void 0:null===(c=s[0])||void 0===c?void 0:null===(u=c.payload)||void 0===u?void 0:u.content)&&void 0!==l?l:""}),a.setState({messages:g})}}}).then((function(){a.setState({users:e.room.users})})),a}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this,t=this.state.users.filter((function(t){return t.id!==e.props.user.id})).map((function(t){return i.a.createElement(le.a.Item,{key:t.id},i.a.createElement(le.a.Content,{floated:"right"},i.a.createElement("a",{onClick:function(){return e.challengePlayer(t)}},"Challenge")),i.a.createElement(le.a.Content,null,t.name))})),a=this.state.messages.map((function(t){var a;return t.opponent&&(a=i.a.createElement(he.a.Actions,null,i.a.createElement(he.a.Action,{onClick:function(){return e.acceptChallenge(t.user)}},"Accept Challenge"))),i.a.createElement(he.a,{key:t.id},i.a.createElement(he.a.Content,null,i.a.createElement(he.a.Author,null,t.user),i.a.createElement(he.a.Text,null,t.message),a))})),n=this.props.game&&ve?i.a.createElement(Z,{roomId:this.props.game,offlineMode:!1,userId:this.props.user.id,ref:function(t){e.gameBoard=t}}):null;return n||i.a.createElement(re.a,null,i.a.createElement(re.a.Row,null,i.a.createElement(re.a.Column,{width:12},i.a.createElement(he.a.Group,{style:{height:"20em",overflow:"auto"}},a),i.a.createElement("div",{style:{float:"left",clear:"both"},ref:function(t){e.messagesEnd=t}})),i.a.createElement(re.a.Column,{width:4},i.a.createElement(le.a,{style:{maxHeight:"20em",overflow:"auto"}},i.a.createElement(le.a.Item,null,i.a.createElement("b",null,this.props.user.name)),t))),i.a.createElement(re.a.Row,null,i.a.createElement(re.a.Column,{width:16},i.a.createElement(te.a,{onSubmit:this.handleSubmit.bind(this)},i.a.createElement(de.a,{action:"Post",placeholder:"New Message...",value:this.state.newMessage,fluid:!0,autoFocus:!0,onChange:this.handleNewMessageChange.bind(this)})))))}},{key:"componentDidMount",value:function(){}},{key:"componentDidUpdate",value:function(){}},{key:"scrollToBottom",value:function(){this.messagesEnd.scrollIntoView({behavior:"smooth"})}},{key:"handleNewMessageChange",value:function(e){this.setState({newMessage:e.target.value})}},{key:"handleSubmit",value:function(){var e=this.state.newMessage,t=this.props,a=t.user,n=t.room;a.sendMessage({text:e,roomId:n.id}),this.setState({newMessage:""})}},{key:"challengePlayer",value:function(e){var t=this.props,a=t.user,n=t.room;a.sendMessage({text:"I challenge ".concat(e.name," to a game"),roomId:n.id,attachment:{link:"urn:player:".concat(e.id),type:"file",fetchRequired:!1}})}},{key:"acceptChallenge",value:function(e){var t=this,a=this.props.user;a.createRoom({name:"".concat(a.id," vs ").concat(e),addUserIds:[e]}).then((function(n){t.props.startedGame(n.id,a.id,e).then((function(e){ve=e[t.props.user.id]}))}))}},{key:"getPlayersInRoom",value:function(){var e=this.gameBoard?this.gameBoard.getPlayers():[];return this.state.users.filter((function(t){return e.includes(t.id)}))}}]),t}(i.a.Component),pe=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(d.a)(this,Object(v.a)(t).call(this,e))).state={joined:[],joinable:[]},a.chat=void 0,a.chatManager=void 0,a.chatManager=new oe.ChatManager({instanceLocator:"v1:us1:f3854d62-ebf2-4ee2-8a48-c62ed279fa8f",tokenProvider:new oe.TokenProvider({url:"".concat(Q,"/auth")}),userId:e.username}),a.chatManager.connect().then((function(e){a.setState({currentUser:e}),e.getJoinableRooms().then((function(t){var n=t.find((function(e){return"Lobby"===e.name}));n?e.joinRoom({roomId:n.id}):n=e.rooms.find((function(e){return"Lobby"===e.name})),n&&a.setState({lobbyId:n.id,activeRoom:n.id})})),setInterval(a.pollRooms.bind(Object(ie.a)(a)),5e3),a.pollRooms()})).catch((function(e){console.log("Failed to connect to Chatkit"),console.log(e)})),a}return Object(p.a)(t,e),Object(m.a)(t,[{key:"pollRooms",value:function(){var e=this,t=this.state.currentUser;t.getJoinableRooms().then((function(a){e.setState({joined:t.rooms,joinable:a})}))}},{key:"enterRoom",value:function(e){var t=this;this.state.currentUser.joinRoom({roomId:e}).then((function(){t.setState({activeRoom:e}),t.pollRooms()})).catch((function(){console.log("Failed to enter room")}))}},{key:"leaveRoom",value:function(e){var t=this,a=this.state.currentUser;if(this.chat){var n=this.chat.getPlayersInRoom();1===n.length&&n[0].id===a.id&&a.deleteRoom({roomId:e})}a.leaveRoom({roomId:e}).then((function(){t.pollRooms()})).catch((function(){console.log("Failed to leave room")}))}},{key:"startedGame",value:function(e,t,a){var n=this;return k.a.request({url:"".concat(Q,"/games"),method:"POST",data:{room:e,whitePlayer:t,blackPlayer:a}}).then((function(i){var r;return n.setState({activeRoom:e}),n.pollRooms(),r={},Object(u.a)(r,t,l.phrygians),Object(u.a)(r,a,l.hitites),r}))}},{key:"render",value:function(){var e,t=this,a=this.state.currentUser;if(a){var n=a.rooms.find((function(e){return e.id==t.state.activeRoom}));if(n){var r=this.state.activeRoom!==this.state.lobbyId&&this.state.activeRoom;e=i.a.createElement(me,{user:a,room:n,key:n.id,startedGame:this.startedGame.bind(this),game:r,ref:function(e){t.chat=e}})}}return i.a.createElement(ee.a,{className:"segment-grid-container"},i.a.createElement(re.a,null,i.a.createElement(re.a.Column,{width:2},i.a.createElement(ue,{joined:this.state.joined,joinable:this.state.joinable,activeRoom:this.state.activeRoom,enterRoom:this.enterRoom.bind(this),leaveRoom:this.leaveRoom.bind(this)})),i.a.createElement(re.a.Column,{width:12},e)))}}]),t}(i.a.Component),ge=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(a=Object(d.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(i)))).state={username:""},a}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e;return e=this.state.username?i.a.createElement(pe,{username:this.state.username}):i.a.createElement(ne,{login:this.enterGame.bind(this)}),i.a.createElement(_.a,null,e)}},{key:"enterGame",value:function(e){this.setState({username:e})}}]),t}(i.a.Component);o.a.render(i.a.createElement(ge,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},89:function(e,t,a){}},[[196,1,2]]]);
//# sourceMappingURL=main.ace5c95e.chunk.js.map